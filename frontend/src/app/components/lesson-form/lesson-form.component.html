<div class="lesson-form-container">
  <div class="lesson-form-wrapper">
    <!-- Header -->
    <div class="lesson-form-header">
      <div class="header-content">
        <div class="header-title">
          <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
          </svg>
          <div class="title-text">
            <h1>{{ isEditMode ? 'Edit Lesson' : 'Create New Lesson' }}</h1>
            <p *ngIf="course" class="course-info">
              {{ course.title }} • {{ course.instructor?.name || 'Unknown Instructor' }}
            </p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn-outline" (click)="onPreview()" [disabled]="lessonForm.invalid">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            Preview
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>{{ isEditMode ? 'Loading lesson...' : 'Creating lesson...' }}</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
      </div>
      <h3 class="error-title">Error</h3>
      <p class="error-message">{{ error }}</p>
      <button class="btn-primary" (click)="isEditMode ? loadLesson() : lessonForm.reset()">
        Try Again
      </button>
    </div>

    <!-- Success State -->
    <div *ngIf="success && !loading" class="success-state">
      <div class="success-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
      </div>
      <h3 class="success-title">Success!</h3>
      <p class="success-message">{{ success }}</p>
    </div>

    <!-- Form -->
    <form *ngIf="!loading && !error" [formGroup]="lessonForm" (ngSubmit)="onSubmit()" class="lesson-form-card">
      
      <!-- Basic Information Section -->
      <div class="form-section">
        <div class="section-title">
          <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
          <h2>Basic Information</h2>
        </div>

        <div class="form-grid">
          <div class="form-group full-width">
            <label class="form-label">
              <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
              </svg>
              Lesson Title
              <span class="required">*</span>
            </label>
            <input 
              type="text" 
              formControlName="title"
              class="form-input"
              [class.error]="isFieldInvalid('title')"
              placeholder="Enter lesson title...">
            <div *ngIf="isFieldInvalid('title')" class="form-error">
              <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              {{ getFieldError('title') }}
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
              </svg>
              Duration (minutes)
              <span class="required">*</span>
            </label>
            <input 
              type="number" 
              formControlName="duration"
              class="form-input"
              [class.error]="isFieldInvalid('duration')"
              min="1" 
              max="300"
              placeholder="45">
            <div *ngIf="isFieldInvalid('duration')" class="form-error">
              <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              {{ getFieldError('duration') }}
            </div>
            <div *ngIf="lessonForm.get('duration')?.value" class="duration-display">
              {{ formatDuration(lessonForm.get('duration')?.value) }}
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">
              <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 6h18"/>
                <path d="M3 12h18"/>
                <path d="M3 18h18"/>
              </svg>
              Order
              <span class="required">*</span>
            </label>
            <input 
              type="number" 
              formControlName="order"
              class="form-input"
              [class.error]="isFieldInvalid('order')"
              min="1"
              placeholder="1">
            <div *ngIf="isFieldInvalid('order')" class="form-error">
              <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              {{ getFieldError('order') }}
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            Description
            <span class="required">*</span>
          </label>
          <textarea 
            formControlName="description"
            class="form-textarea"
            [class.error]="isFieldInvalid('description')"
            placeholder="Brief description of what students will learn in this lesson..."
            rows="3"></textarea>
          <div *ngIf="isFieldInvalid('description')" class="form-error">
            <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            {{ getFieldError('description') }}
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div class="form-section">
        <div class="section-title">
          <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10,9 9,9 8,9"/>
          </svg>
          <h2>Lesson Content</h2>
        </div>

        <div class="form-group">
          <label class="form-label">
            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            Content (Markdown)
            <span class="required">*</span>
          </label>
          <textarea 
            formControlName="content"
            class="form-textarea large"
            [class.error]="isFieldInvalid('content')"
            placeholder="Write your lesson content using Markdown format..."
            rows="15"></textarea>
          <div *ngIf="isFieldInvalid('content')" class="form-error">
            <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            {{ getFieldError('content') }}
          </div>
          <div *ngIf="lessonForm.get('content')?.value" class="content-stats">
            <span class="word-count">{{ getWordCount(lessonForm.get('content')?.value) }} words</span>
            <span class="reading-time">~{{ getEstimatedReadingTime(lessonForm.get('content')?.value) }} min read</span>
          </div>
        </div>
      </div>

      <!-- Media Section -->
      <div class="form-section">
        <div class="section-title">
          <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="23 7 16 12 23 17 23 7"/>
            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
          </svg>
          <h2>Media & Resources</h2>
        </div>

        <div class="form-group">
          <label class="form-label">
            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="23 7 16 12 23 17 23 7"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Video URL (Optional)
          </label>
          <input 
            type="url" 
            formControlName="videoUrl"
            class="form-input"
            [class.error]="isFieldInvalid('videoUrl')"
            placeholder="https://www.youtube.com/watch?v=...">
          <div *ngIf="isFieldInvalid('videoUrl')" class="form-error">
            <svg class="form-error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
            </svg>
            {{ getFieldError('videoUrl') }}
          </div>
          <div class="video-hint">
            <svg class="hint-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
              <line x1="12" y1="17" x2="12.01" y2="17"/>
            </svg>
            Supported platforms: YouTube, Vimeo, Dailymotion
          </div>
        </div>

        <!-- Video Upload Component -->
        <div class="form-group">
          <label class="form-label">
            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="23 7 16 12 23 17 23 7"/>
              <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
            </svg>
            Upload Video File (MP4)
          </label>
          <app-video-upload 
            [courseId]="courseId!"
            [lessonId]="lessonId || 0"
            (videoUploaded)="onVideoUploaded($event)">
          </app-video-upload>
          <div *ngIf="uploadedVideoFilename" class="upload-success">
            <svg class="success-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
            <div class="success-content">
              <strong>✅ Video uploaded successfully!</strong>
              <p>Video is now stored in S3 and will be available in the lesson.</p>
              <small>URL field cleared automatically</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Section -->
      <div class="form-section">
        <div class="section-title">
          <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
          <h2>Publishing Settings</h2>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                formControlName="isPublished"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <div class="checkbox-content">
                <h4>Publish Lesson</h4>
                <p>Make this lesson visible to students</p>
              </div>
            </label>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn-outline" (click)="onCancel()">
          <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Cancel
        </button>
        <button type="submit" class="btn-primary" [disabled]="lessonForm.invalid || loading">
          <div class="btn-content">
            <svg *ngIf="!loading" class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17,21 17,13 7,13 7,21"/>
              <polyline points="7,3 7,8 15,8"/>
            </svg>
            <div *ngIf="loading" class="spinner-small"></div>
            {{ loading ? (isEditMode ? 'Updating...' : 'Creating...') : (isEditMode ? 'Update Lesson' : 'Create Lesson') }}
          </div>
        </button>
      </div>
    </form>
  </div>
</div>
