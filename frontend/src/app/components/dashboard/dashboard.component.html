<div class="dashboard-container">
  <!-- Enhanced Welcome Section -->
  <div class="welcome-hero">
    <div class="welcome-content">
      <div class="welcome-badge">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>Today is {{ getCurrentDate() }}</span>
      </div>
      <h1 class="welcome-title">Welcome back, {{ currentUser?.name }}! üëã</h1>
      <p class="welcome-subtitle">Here's everything happening in your learning journey</p>
      
      <!-- Quick Stats -->
      <div class="welcome-stats">
        <div class="welcome-stat-item">
          <div class="welcome-stat-value">{{ getTotalCourses() }}</div>
          <div class="welcome-stat-label">{{ getRoleBasedLabel() }}</div>
        </div>
        <div class="welcome-stat-divider"></div>
        <div class="welcome-stat-item">
          <div class="welcome-stat-value">{{ getProgressStat() }}%</div>
          <div class="welcome-stat-label">{{ getProgressLabel() }}</div>
        </div>
      </div>
    </div>
    
    <!-- Decorative elements -->
    <div class="welcome-decoration">
      <div class="decoration-circle circle-1"></div>
      <div class="decoration-circle circle-2"></div>
      <div class="decoration-circle circle-3"></div>
    </div>
  </div>

  <div class="main-content">

    <!-- Student Dashboard -->
    <div *ngIf="currentUser?.role === 'STUDENT'" class="student-dashboard">
      <div class="stats-section">
        <h3>Your Progress</h3>
        <div class="stats-grid">
          <div class="stat-card enhanced">
            <div class="stat-icon">üìö</div>
            <h4>{{ dashboardData?.myEnrolledCourses?.length || 0 }}</h4>
            <p>Enrolled Courses</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.myEnrolledCourses?.length || 0) / 10) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">‚úÖ</div>
            <h4>{{ completedCourses }}</h4>
            <p>Completed Courses</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': getCompletionPercentage() + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üèÜ</div>
            <h4>{{ dashboardData?.certificates?.length || 0 }}</h4>
            <p>Certificates</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.certificates?.length || 0) / 5) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üìä</div>
            <h4>{{ calculateOverallProgress() }}%</h4>
            <p>Overall Progress</p>
            <div class="stat-chart circular">
              <div class="circular-progress" [ngStyle]="{'--progress': calculateOverallProgress() + '%'}"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Charts Section -->
      <div class="charts-grid">
        <!-- Progress Bar Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>Learning Progress</h3>
            <span class="chart-subtitle">Your enrolled courses</span>
          </div>
          <div class="modern-activity-chart">
            <div *ngFor="let enrollment of dashboardData?.myEnrolledCourses || []" class="chart-bar-modern">
              <div class="bar-container">
                <div class="bar-modern" [style.height.%]="capProgress(enrollment.progress)" [attr.data-value]="capProgress(enrollment.progress)">
                  <span class="bar-value">{{ capProgress(enrollment.progress) }}%</span>
                </div>
                <div class="bar-label">{{ enrollment.course.title | slice:0:8 }}...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Course Status Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>Course Status</h3>
            <div class="chart-controls">
              <span class="chart-subtitle">Completion overview</span>
              <div class="chart-toggle">
                <button (click)="toggleChartType()" class="toggle-btn" [class.active]="chartType === 'donut'">
                  <span class="chart-icon">üç©</span>
                </button>
                <button (click)="toggleChartType()" class="toggle-btn" [class.active]="chartType === 'bar'">
                  <span class="chart-icon">üìä</span>
                </button>
              </div>
            </div>
          </div>
          <div class="donut-chart-container">
            <!-- Donut Chart -->
            <canvas *ngIf="chartType === 'donut'" baseChart
                    [data]="donutChartData"
                    [type]="donutChartType"
                    [options]="donutChartOptions">
            </canvas>
            <!-- Bar Chart -->
            <canvas *ngIf="chartType === 'bar'" baseChart
                    [data]="barChartData"
                    [type]="barChartType"
                    [options]="barChartOptions">
            </canvas>
            <div *ngIf="hasNoData()" 
                 class="no-data-message">
              <div class="no-data-icon">üìä</div>
              <p>No data available</p>
            </div>
          </div>
        </div>
      </div>

      <div class="courses-section">
        <div class="section-header">
          <div>
            <h3>My Courses</h3>
            <p class="section-subtitle">Your learning journey continues here</p>
          </div>
          <button class="btn-secondary" routerLink="/courses">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Browse More
          </button>
        </div>
        
        <div *ngIf="dashboardData?.myEnrolledCourses?.length > 0; else noCourses" class="courses-grid">
          <div *ngFor="let enrollment of dashboardData.myEnrolledCourses" class="enhanced-course-card">
            <div class="course-card-content">
              <!-- Course Thumbnail -->
              <div class="course-thumbnail-wrapper">
                <img [src]="enrollment.course.thumbnail || '/assets/images/default-course-placeholder.png'" 
                     [alt]="enrollment.course.title"
                     class="course-thumbnail-image"
                     onerror="this.src='/assets/images/default-course-placeholder.png'">
                <div class="thumbnail-overlay">
                  <div class="completion-badge" [class.completed]="capProgress(enrollment.progress) === 100">
                    <span *ngIf="capProgress(enrollment.progress) === 100">‚úì Completed</span>
                    <span *ngIf="capProgress(enrollment.progress) < 100">{{ capProgress(enrollment.progress) }}% Done</span>
                  </div>
                </div>
              </div>

              <!-- Course Info -->
              <div class="course-card-body">
                <div class="course-header">
                  <h4 class="course-title">{{ enrollment.course.title }}</h4>
                  <div class="course-difficulty-badge">
                    <span *ngIf="capProgress(enrollment.progress) >= 75">üèÜ</span>
                    <span *ngIf="capProgress(enrollment.progress) >= 50 && capProgress(enrollment.progress) < 75">üìà</span>
                    <span *ngIf="capProgress(enrollment.progress) < 50">üéØ</span>
                  </div>
                </div>
                
                <p class="course-description">{{ enrollment.course.description | slice:0:100 }}...</p>
                
                <div class="course-footer">
                  <div class="course-meta-info">
                    <div class="meta-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>{{ enrollment.course.instructor?.name || 'Unknown Instructor' }}</span>
                    </div>
                    <div class="meta-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>{{ enrollment.course.lessons?.length || 0 }} Lessons</span>
                    </div>
                  </div>

                  <!-- Enhanced Progress Bar -->
                  <div class="progress-section">
                    <div class="progress-header">
                      <span class="progress-label">Progress</span>
                      <span class="progress-percentage">{{ capProgress(enrollment.progress) }}%</span>
                    </div>
                    <div class="modern-progress-bar">
                      <div class="progress-fill-gradient" [style.width.%]="capProgress(enrollment.progress)">
                        <div class="progress-shine"></div>
                      </div>
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="course-actions">
                    <button class="btn-continue" (click)="viewCourse(enrollment.course.id)">
                      <span *ngIf="capProgress(enrollment.progress) > 0 && capProgress(enrollment.progress) < 100" class="button-content">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                          <polygon points="5 3 19 12 5 21 5 3" fill="currentColor"/>
                        </svg>
                        <span>Continue Learning</span>
                      </span>
                      <span *ngIf="enrollment.progress === 0" class="button-content">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                          <polygon points="5 3 19 12 5 21 5 3" fill="currentColor"/>
                        </svg>
                        <span>Start Course</span>
                      </span>
                      <span *ngIf="enrollment.progress === 100" class="button-content">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                          <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                        <span>Review Course</span>
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <ng-template #noCourses>
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <h3>No courses yet</h3>
            <p>Start your learning journey by enrolling in a course</p>
            <button class="btn-primary" routerLink="/courses">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Browse Courses
            </button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Instructor Dashboard -->
    <div *ngIf="currentUser?.role === 'INSTRUCTOR'" class="instructor-dashboard">
      <div class="stats-section">
        <h3>Your Teaching Stats</h3>
        <div class="stats-grid">
          <div class="stat-card enhanced">
            <div class="stat-icon">üìñ</div>
            <h4>{{ dashboardData?.myCourses?.length || 0 }}</h4>
            <p>My Courses</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.myCourses?.length || 0) / 10) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üë•</div>
            <h4>{{ dashboardData?.totalStudents || 0 }}</h4>
            <p>Total Students</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.totalStudents || 0) / 100) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üë•</div>
            <h4>{{ calculateAverageStudentsPerCourse() }}</h4>
            <p>Avg Students/Course</p>
            <div class="stat-chart circular">
              <div class="circular-progress" [ngStyle]="{'--progress': '100%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üìà</div>
            <h4>{{ calculateTotalEnrollments() }}</h4>
            <p>Total Enrollments</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((calculateTotalEnrollments() / 100) * 100) + '%'}"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Charts Section -->
      <div class="charts-grid">
        <!-- Enrollment Bar Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>Course Enrollments</h3>
            <span class="chart-subtitle">Your courses</span>
          </div>
          <div class="modern-trend-chart">
            <div *ngFor="let course of dashboardData?.myCourses || []" class="trend-bar-modern">
              <div class="bar-container">
                <div class="bar-modern-trend" [style.height.%]="Math.min((course.enrollmentCount || 0) * 2, 100)" [attr.data-value]="course.enrollmentCount">
                  <span class="bar-value">{{ course.enrollmentCount || 0 }}</span>
                </div>
                <div class="bar-label">{{ course.title | slice:0:8 }}...</div>
              </div>
            </div>
          </div>
        </div>

          <!-- Enrollment Donut Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>Enrollment Overview</h3>
            <span class="chart-subtitle">Course Enrollments</span>
          </div>
          <div class="donut-chart-container">
            <canvas baseChart
                    [data]="donutChartData"
                    [type]="donutChartType"
                    [options]="donutChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <div class="courses-section">
        <div class="section-header">
          <div>
            <h3>My Courses</h3>
            <p class="section-subtitle">Manage and track your teaching content</p>
          </div>
          <button class="btn-secondary" routerLink="/courses/create">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Create Course
          </button>
        </div>
        
        <div *ngIf="dashboardData?.myCourses?.length > 0; else noInstructorCourses" class="courses-grid">
          <div *ngFor="let course of dashboardData.myCourses" class="enhanced-course-card instructor-card">
            <div class="course-card-content">
              <!-- Course Thumbnail -->
              <div class="course-thumbnail-wrapper">
                <img [src]="course.thumbnail || '/assets/images/default-course-placeholder.png'" 
                     [alt]="course.title"
                     class="course-thumbnail-image"
                     onerror="this.src='/assets/images/default-course-placeholder.png'">
                <div class="thumbnail-overlay">
                  <div class="enrollment-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>{{ course.enrollmentCount || 0 }} {{ (course.enrollmentCount || 0) === 1 ? 'student' : 'students' }}</span>
                  </div>
                </div>
              </div>

              <!-- Course Info -->
              <div class="course-card-body">
                <div class="course-header">
                  <h4 class="course-title">{{ course.title }}</h4>
                  <div class="lesson-count-badge">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>{{ course.lessons?.length || 0 }}</span>
                  </div>
                </div>
                
                <p class="course-description">{{ course.description | slice:0:100 }}...</p>
                
                <div class="course-footer">
                  <div class="course-meta-info">
                    <div class="meta-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>{{ course.enrollmentCount || 0 }} {{ (course.enrollmentCount || 0) === 1 ? 'student' : 'students' }}</span>
                    </div>
                    <div class="meta-item">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>{{ course.lessons?.length || 0 }} lessons</span>
                    </div>
                  </div>

                  <!-- Action Buttons -->
                  <div class="course-actions instructor-actions">
                    <button class="btn-view" (click)="viewCourse(course.id)">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>View</span>
                    </button>
                    <button class="btn-edit" (click)="editCourse(course.id)">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Edit</span>
                    </button>
                    <button class="btn-delete-course" (click)="deleteCourse(course.id)">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2"/>
                      </svg>
                      <span>Delete</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <ng-template #noInstructorCourses>
          <div class="empty-state">
            <div class="empty-state-icon">
              <svg width="80" height="80" viewBox="0 0 24 24" fill="none">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="currentColor" stroke-width="2"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            <h3>No courses yet</h3>
            <p>Start teaching by creating your first course</p>
            <button class="btn-primary" routerLink="/courses/create">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 4V20M4 12H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Create Course
            </button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Admin Dashboard -->
    <div *ngIf="currentUser?.role === 'ADMIN'" class="admin-dashboard">
      <div class="stats-section">
        <h3>Platform Statistics</h3>
        <div class="stats-grid">
          <div class="stat-card enhanced">
            <div class="stat-icon">üë§</div>
            <h4>{{ dashboardData?.totalUsers || 0 }}</h4>
            <p>Total Users</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.totalUsers || 0) / 100) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üìö</div>
            <h4>{{ dashboardData?.totalCourses || 0 }}</h4>
            <p>Total Courses</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.totalCourses || 0) / 50) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üìä</div>
            <h4>{{ dashboardData?.totalEnrollments || 0 }}</h4>
            <p>Total Enrollments</p>
            <div class="stat-chart">
              <div class="mini-bar" [ngStyle]="{'width': ((dashboardData?.totalEnrollments || 0) / 200) * 100 + '%'}"></div>
            </div>
          </div>
          <div class="stat-card enhanced">
            <div class="stat-icon">üìà</div>
            <h4>{{ dashboardData?.totalEnrollments || 0 }}</h4>
            <p>Total Enrollments</p>
            <div class="stat-chart circular">
              <div class="circular-progress" [ngStyle]="{'--progress': ((dashboardData?.totalEnrollments || 0) / 100) * 100 + '%'}"></div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Charts Section -->
      <div class="charts-grid">
        <!-- Platform Overview Bar Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>Platform Overview</h3>
            <span class="chart-subtitle">Current statistics</span>
          </div>
          <div class="modern-growth-chart">
            <div class="growth-item-modern">
              <div class="dual-bars">
                <div class="bar-container">
                  <div class="bar-modern-users" [style.height.%]="Math.min((dashboardData?.totalUsers || 0) * 2, 100)" [attr.data-value]="dashboardData?.totalUsers">
                    <span class="bar-value">{{ dashboardData?.totalUsers || 0 }}</span>
                  </div>
                </div>
                <div class="bar-container">
                  <div class="bar-modern-courses" [style.height.%]="Math.min((dashboardData?.totalCourses || 0) * 2, 100)" [attr.data-value]="dashboardData?.totalCourses">
                    <span class="bar-value">{{ dashboardData?.totalCourses || 0 }}</span>
                  </div>
                </div>
              </div>
              <div class="bar-label">Current</div>
            </div>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(180deg, #6366f1 0%, #8b5cf6 100%);"></span>
              <span>Users</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: linear-gradient(180deg, #ec4899 0%, #f472b6 100%);"></span>
              <span>Courses</span>
            </div>
          </div>
        </div>

        <!-- User Distribution Pie Chart -->
        <div class="chart-section modern-chart">
          <div class="chart-header">
            <h3>User Distribution</h3>
            <span class="chart-subtitle">Platform users</span>
          </div>
          <div class="donut-chart-container">
            <canvas baseChart
                    [data]="donutChartData"
                    [type]="donutChartType"
                    [options]="donutChartOptions">
            </canvas>
          </div>
        </div>
      </div>

      <div class="admin-actions">
        <h3>Admin Actions</h3>
        <div class="action-buttons">
          <button class="btn btn-primary" routerLink="/admin">Admin Panel</button>
          <button class="btn btn-secondary" routerLink="/courses">Manage Courses</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading/No Data Template -->
  <div *ngIf="!dashboardData" class="no-data">
    <h3>Loading your dashboard...</h3>
    <p>Please wait while we fetch your data from the server.</p>
  </div>
</div>