<div class="admin-panel-container">
  <div class="admin-panel-wrapper">
    <!-- Header -->
    <div class="admin-header">
      <div class="header-content">
        <div class="header-title">
          <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
          <div class="header-text">
            <h1>Admin Panel</h1>
            <p class="header-subtitle">Manage your platform with ease</p>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn-outline" (click)="refreshData()" [disabled]="loading">
            <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
              <path d="M21 3v5h-5"/>
              <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
              <path d="M3 21v-5h5"/>
            </svg>
            <span>Refresh</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="admin-nav">
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="7"/>
          <rect x="14" y="3" width="7" height="7"/>
          <rect x="14" y="14" width="7" height="7"/>
          <rect x="3" y="14" width="7" height="7"/>
        </svg>
        <span>Overview</span>
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'users'"
        (click)="setActiveTab('users')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
        <span>Users</span>
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'courses'"
        (click)="setActiveTab('courses')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
        <span>Courses</span>
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'analytics'"
        (click)="setActiveTab('analytics')">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 20V10"/>
          <path d="M12 20V4"/>
          <path d="M6 20v-6"/>
        </svg>
        <span>Analytics</span>
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading admin data...</p>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
      </div>
      <h3 class="error-title">Error Loading Data</h3>
      <p class="error-message">{{ error }}</p>
      <button class="btn-primary" (click)="loadAdminData()">
        Try Again
      </button>
    </div>

    <!-- Content -->
    <div *ngIf="!loading && !error" class="admin-content">
      
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="tab-content">
        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon-wrapper">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{ stats.totalUsers }}</h3>
              <p class="stat-label">Total Users</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon-wrapper">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{ stats.totalCourses }}</h3>
              <p class="stat-label">Total Courses</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon-wrapper">
              <svg class="stat-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{ stats.totalEnrollments }}</h3>
              <p class="stat-label">Total Enrollments</p>
            </div>
          </div>
          
        </div>

        <!-- Recent Activity -->
        <div class="overview-sections">
          <div class="overview-section">
            <div class="section-header">
              <h3>Recent Users</h3>
              <button class="btn-outline" (click)="setActiveTab('users')">
                View All
              </button>
            </div>
            <div class="recent-list">
              <div *ngFor="let user of stats.recentUsers" class="recent-item">
                <div class="user-avatar">
                  <div class="avatar-placeholder">{{ user.name?.charAt(0) || 'U' }}</div>
                </div>
                <div class="user-info">
                  <h4>{{ user.name || 'Unknown User' }}</h4>
                  <p>{{ user.email || 'No email' }}</p>
                </div>
                <div class="user-badge" [class]="getUserRoleBadgeClass(user.role)">
                  {{ user.role || 'STUDENT' }}
                </div>
              </div>
            </div>
          </div>

          <div class="overview-section">
            <div class="section-header">
              <h3>Top Courses</h3>
              <button class="btn-outline" (click)="setActiveTab('courses')">
                View All
              </button>
            </div>
            <div class="recent-list">
              <div *ngFor="let course of stats.topCourses" class="recent-item">
                <div class="course-thumbnail">
                  <div class="course-placeholder">{{ course.title?.charAt(0) || 'C' }}</div>
                </div>
                <div class="course-info">
                  <h4>{{ course.title || 'Unknown Course' }}</h4>
                  <p>{{ course.instructor || 'Unknown Instructor' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Tab -->
      <div *ngIf="activeTab === 'users'" class="tab-content">
        <div class="tab-header">
          <h2>User Management</h2>
          <div class="tab-actions">
            <div class="search-bar">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <input 
                type="text" 
                placeholder="Search users..." 
                [(ngModel)]="userSearchTerm"
                (input)="searchUsers()">
            </div>
            <select class="filter-select" [(ngModel)]="userFilterRole" (change)="filterUsersByRole(userFilterRole)">
              <option value="">All Roles</option>
              <option value="STUDENT">Students</option>
              <option value="INSTRUCTOR">Instructors</option>
              <option value="ADMIN">Admins</option>
            </select>
            <button class="btn-outline btn-sm" (click)="exportData('users')">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Export
            </button>
          </div>
        </div>

        <div class="users-table">
          <div class="table-header">
            <div class="table-cell">User</div>
            <div class="table-cell">Role</div>
            <div class="table-cell">Actions</div>
          </div>
          <div *ngFor="let user of filteredUsers" class="table-row">
            <div class="table-cell">
              <div class="user-cell">
                <div class="user-avatar-small avatar-placeholder" *ngIf="!user.avatar">
                  {{ user.name?.charAt(0) || 'U' }}
                </div>
                <img *ngIf="user.avatar" [src]="user.avatar" [alt]="user.name" class="user-avatar-small">
                <div class="user-details">
                  <h4>{{ user.name || 'Unknown User' }}</h4>
                  <p>{{ user.email || 'No email' }}</p>
                </div>
              </div>
            </div>
            <div class="table-cell">
              <span class="user-badge" [class]="getUserRoleBadgeClass(user.role?.roleName || 'STUDENT')">
                {{ user.role?.roleName || 'STUDENT' }}
              </span>
            </div>
            <div class="table-cell">
              <div class="action-buttons">
                <button class="btn-sm btn-danger" (click)="deleteUser(user)">
                  <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
          <button 
            class="page-btn" 
            [disabled]="userCurrentPage === 1"
            (click)="goToPage(userCurrentPage - 1, 'user')">
            Previous
          </button>
          <span *ngIf="userCurrentPage > 4 && userTotalPages > 7" 
                class="page-number"
                (click)="goToPage(1, 'user')">
            1
          </span>
          <span *ngIf="userCurrentPage > 4 && userTotalPages > 7" class="page-ellipsis">...</span>
          <span *ngFor="let page of getPageNumbers(userTotalPages, userCurrentPage)" 
                class="page-number"
                [class.active]="page === userCurrentPage"
                (click)="goToPage(page, 'user')">
            {{ page }}
          </span>
          <span *ngIf="userCurrentPage < userTotalPages - 3 && userTotalPages > 7" class="page-ellipsis">...</span>
          <span *ngIf="userCurrentPage < userTotalPages - 3 && userTotalPages > 7" 
                class="page-number"
                (click)="goToPage(userTotalPages, 'user')">
            {{ userTotalPages }}
          </span>
          <button 
            class="page-btn" 
            [disabled]="userCurrentPage === userTotalPages"
            (click)="goToPage(userCurrentPage + 1, 'user')">
            Next
          </button>
        </div>
      </div>

      <!-- Courses Tab -->
      <div *ngIf="activeTab === 'courses'" class="tab-content">
        <div class="tab-header">
          <h2>Course Management</h2>
          <div class="tab-actions">
            <div class="search-bar">
              <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
              <input 
                type="text" 
                placeholder="Search courses..." 
                [(ngModel)]="courseSearchTerm"
                (input)="searchCourses()">
            </div>
            <button class="btn-outline btn-sm" (click)="exportData('courses')">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Export
            </button>
          </div>
        </div>

        <div class="courses-table">
          <div class="table-header">
            <div class="table-cell">Course</div>
            <div class="table-cell">Instructor</div>
            <div class="table-cell">Actions</div>
          </div>
          <div *ngFor="let course of filteredCourses" class="table-row">
            <div class="table-cell">
              <div class="course-cell">
                <div class="course-thumbnail-small course-placeholder" *ngIf="!course.thumbnail">
                  {{ course.title?.charAt(0) || 'C' }}
                </div>
                <img *ngIf="course.thumbnail" [src]="course.thumbnail" [alt]="course.title" class="course-thumbnail-small">
                <div class="course-details">
                  <h4>{{ course.title || 'Unknown Course' }}</h4>
                </div>
              </div>
            </div>
            <div class="table-cell">{{ course.instructor?.name || 'Unknown Instructor' }}</div>
            <div class="table-cell">
              <div class="action-buttons">
                <button class="btn-sm btn-danger" (click)="deleteCourse(course)">
                  <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3,6 5,6 21,6"></polyline>
                    <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination">
          <button 
            class="page-btn" 
            [disabled]="courseCurrentPage === 1"
            (click)="goToPage(courseCurrentPage - 1, 'course')">
            Previous
          </button>
          <span *ngIf="courseCurrentPage > 4 && courseTotalPages > 7" 
                class="page-number"
                (click)="goToPage(1, 'course')">
            1
          </span>
          <span *ngIf="courseCurrentPage > 4 && courseTotalPages > 7" class="page-ellipsis">...</span>
          <span *ngFor="let page of getPageNumbers(courseTotalPages, courseCurrentPage)" 
                class="page-number"
                [class.active]="page === courseCurrentPage"
                (click)="goToPage(page, 'course')">
            {{ page }}
          </span>
          <span *ngIf="courseCurrentPage < courseTotalPages - 3 && courseTotalPages > 7" class="page-ellipsis">...</span>
          <span *ngIf="courseCurrentPage < courseTotalPages - 3 && courseTotalPages > 7" 
                class="page-number"
                (click)="goToPage(courseTotalPages, 'course')">
            {{ courseTotalPages }}
          </span>
          <button 
            class="page-btn" 
            [disabled]="courseCurrentPage === courseTotalPages"
            (click)="goToPage(courseCurrentPage + 1, 'course')">
            Next
          </button>
        </div>
      </div>

      <!-- Analytics Tab -->
      <div *ngIf="activeTab === 'analytics'" class="tab-content">
        <div class="tab-header">
          <h2>Analytics Dashboard</h2>
          <div class="tab-actions">
            <button class="btn-outline btn-sm" (click)="exportData('analytics')">
              <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7,10 12,15 17,10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
              </svg>
              Export
            </button>
          </div>
        </div>

        <div class="analytics-stats-grid">
          <div class="stat-box">
            <div class="stat-icon">👥</div>
            <div class="stat-info">
              <h3>{{ platformStats.totalUsers }}</h3>
              <p>Total Users</p>
            </div>
          </div>
          
          <div class="stat-box">
            <div class="stat-icon">🎓</div>
            <div class="stat-info">
              <h3>{{ platformStats.totalStudents }}</h3>
              <p>Students</p>
            </div>
          </div>
          
          <div class="stat-box">
            <div class="stat-icon">👨‍🏫</div>
            <div class="stat-info">
              <h3>{{ platformStats.totalInstructors }}</h3>
              <p>Instructors</p>
            </div>
          </div>
          
          <div class="stat-box">
            <div class="stat-icon">📚</div>
            <div class="stat-info">
              <h3>{{ platformStats.totalCourses }}</h3>
              <p>Courses</p>
            </div>
          </div>
          
          <div class="stat-box">
            <div class="stat-icon">📊</div>
            <div class="stat-info">
              <h3>{{ platformStats.totalEnrollments }}</h3>
              <p>Total Enrollments</p>
            </div>
          </div>
          
            <div class="stat-box">
              <div class="stat-icon">📈</div>
              <div class="stat-info">
                <h3>{{ calculateEnrollmentRate() }}</h3>
                <p>Avg Enrollments/Student</p>
              </div>
            </div>
        </div>
        
        <!-- Real-time Analytics Charts -->
        <div class="analytics-charts-grid">
          <div class="chart-card">
            <h3>📊 Platform Statistics</h3>
            <div class="chart-container">
              <canvas baseChart
                [datasets]="userGrowthData.datasets"
                [labels]="userGrowthData.labels"
                [options]="barChartOptions"
                [type]="'bar'">
              </canvas>
            </div>
          </div>
          
          <div class="chart-card">
            <h3>📈 Enrollment Overview</h3>
            <div class="chart-container">
              <canvas baseChart
                [datasets]="enrollmentChartData.datasets"
                [labels]="enrollmentChartData.labels"
                [options]="barChartOptions"
                [type]="'bar'">
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


